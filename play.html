<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Love Waveform Audio Player - No Scroll</title>
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(#FFB6C1, #FF69B4);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            transition: background 0.5s ease;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative; /* Untuk posisi snowflakes */
        }

        /* Animasi salju yang berjatuhan */
        .snowflake {
            position: absolute;
            top: -10px;
            color: white;
            font-size: 1em;
            user-select: none;
            animation: fall linear infinite;
            pointer-events: none;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        #loading {
            position: fixed;
            inset: 0;
            background: rgba(255, 182, 193, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            font-size: 22px;
            text-shadow: 0 0 10px #FF1493;
        }

        .heart-loader { font-size: 90px; animation: pulse 1.4s infinite; margin-bottom: 20px; }
        @keyframes pulse { 0%,100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.4); opacity: 1; } }

        .hearts-float { display: flex; gap: 25px; margin-bottom: 30px; }
        .small-heart { font-size: 40px; animation: float 3.5s infinite ease-in-out; }
        .small-heart:nth-child(1) { animation-delay: 0s; }
        .small-heart:nth-child(2) { animation-delay: 0.6s; }
        .small-heart:nth-child(3) { animation-delay: 1.2s; }
        @keyframes float { 0%,100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-50px) rotate(25deg); } }

        #waveform {
            width: 92%;
            height: 220px;
            margin: 25px 0;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
            display: none;
        }

        #controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
            margin-top: 25px;
        }

        #play-pause, #show-letter-btn {
            background: #FF1493;
            border: none;
            color: white;
            padding: 16px 35px;
            border-radius: 60px;
            font-size: 19px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 18px rgba(255,20,147,0.6);
        }

        #play-pause:hover, #show-letter-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 12px 25px rgba(255,20,147,0.8);
        }

        #tutorial {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.96);
            padding: 45px 60px;
            border-radius: 35px;
            z-index: 10;
            text-align: center;
            font-size: 21px;
            color: #222;
            max-width: 85%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.35);
            display: none;
        }

        #tutorial button {
            margin-top: 25px;
            background: #FF69B4;
            border: none;
            color: white;
            padding: 16px 40px;
            border-radius: 60px;
            font-size: 19px;
            cursor: pointer;
            transition: background 0.3s;
        }

        #tutorial button:hover { background: #FF1493; }

        .glow-pink {
            background: linear-gradient(#FF69B4, #FF1493) !important;
            box-shadow: 0 0 80px #FF69B4;
        }

        #progress-container {
            width: 92%;
            height: 8px;
            background: rgba(255,255,255,0.4);
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        #progress-bar {
            height: 100%;
            width: 0;
            background: linear-gradient(to right, #FFB6C1, #FF1493);
            transition: width 0.2s;
        }

        #loading-progress {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        /* Popup untuk gambar surat */
        #image-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        #popup-image {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        #close-popup {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #FF1493;
            border: none;
            color: white;
            font-size: 16px;
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        #close-popup:hover {
            background: #c00;
        }
    </style>
</head>
<body>
    <!-- Elemen untuk salju yang berjatuhan -->
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <div class="snowflake">‚ùÑÔ∏è</div>
    <!-- Tambahkan lebih banyak jika diperlukan untuk efek lebih padat -->

    <div id="loading">
        <div class="heart-loader">üíñ</div>
        <div class="hearts-float">
            <span class="small-heart">‚ù§Ô∏è</span>
            <span class="small-heart">üíó</span>
            <span class="small-heart">üíû</span>
        </div>
        <p>Memuat & memproses audio...</p>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="loading-progress">0%</div>
    </div>

    <div id="tutorial">
        <p>Tekan tombol mulai di bawah untuk memutar lagu.<br>Waveform akan muncul setelah audio siap.</p>
        <button id="start-btn">Mulai Pengalaman Cinta ‚ù§Ô∏è</button>
    </div>

    <div id="waveform"></div>
    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>

    <div id="controls">
        <button id="play-pause">Putar üíñ</button>
        <button id="show-letter-btn">Tampilkan surat üíï</button>
    </div>

    <!-- Popup untuk gambar surat -->
    <div id="image-popup">
        <img id="popup-image" src="surat.png" alt="Surat">
        <button id="close-popup">X</button>
    </div>

    <audio id="audio" preload="auto"></audio>

    <script>
        const audio = document.getElementById('audio');
        const loading = document.getElementById('loading');
        const tutorial = document.getElementById('tutorial');
        const waveformContainer = document.getElementById('waveform');
        const playPauseBtn = document.getElementById('play-pause');
        const startBtn = document.getElementById('start-btn');
        const showLetterBtn = document.getElementById('show-letter-btn');
        const imagePopup = document.getElementById('image-popup');
        const closePopup = document.getElementById('close-popup');
        const progressBar = document.getElementById('progress-bar');
        const loadingProgress = document.getElementById('loading-progress');
        const body = document.body;

        let wavesurfer;
        let audioSrc = 'sound1.mp3'; // <-- GANTI dengan file audio default kamu
        let wakeLock = null;

        // Inisialisasi animasi salju
        const snowflakes = document.querySelectorAll('.snowflake');
        snowflakes.forEach((flake) => {
            const duration = Math.random() * 10 + 5; // 5-15 detik
            const delay = Math.random() * 5;
            const left = Math.random() * 100;
            const size = Math.random() * 1 + 0.5; // 0.5-1.5 em

            flake.style.left = `${left}%`;
            flake.style.animationDuration = `${duration}s`;
            flake.style.animationDelay = `${delay}s`;
            flake.style.fontSize = `${size}em`;
            flake.style.opacity = Math.random() * 0.5 + 0.5;
        });

        async function init(src) {
            try {
                loading.style.display = 'flex';
                audio.src = src;
                await audio.load();

                wavesurfer = WaveSurfer.create({
                    container: '#waveform',
                    waveColor: '#FF69B4',
                    progressColor: '#FFB6C1',
                    cursorColor: '#fff',
                    barWidth: 4,
                    barRadius: 4,
                    height: 220,
                    responsive: true,
                    normalize: true,
                    backend: 'MediaElement'
                });

                wavesurfer.on('loading', (percent) => {
                    const p = Math.round(percent);
                    progressBar.style.width = p + '%';
                    loadingProgress.textContent = p + '%';
                });

                await wavesurfer.load(src);

                loading.style.display = 'none';
                waveformContainer.style.display = 'block';
                tutorial.style.display = 'block';
                // Tidak mengubah overflowY menjadi 'auto' ‚Üí tetap hidden (no scroll)

                wavesurfer.on('play', () => {
                    playPauseBtn.textContent = 'Pause üíî';
                    body.classList.add('glow-pink');
                });
                wavesurfer.on('pause', () => {
                    playPauseBtn.textContent = 'Putar üíñ';
                    body.classList.remove('glow-pink');
                });
                wavesurfer.on('audioprocess', () => {
                    const prog = wavesurfer.getCurrentTime() / wavesurfer.getDuration() * 100;
                    progressBar.style.width = prog + '%';
                });
                wavesurfer.on('finish', () => wavesurfer.stop());

            } catch (e) {
                console.error(e);
                loading.innerHTML = `
                    <div class="heart-loader" style="color:#c00; animation:none;">‚ùå</div>
                    <p style="color:#c00; font-size:24px; margin-top:30px; text-align:center;">
                        GAGAL MEMUAT AUDIO<br><br>
                        Cek file "${src}" ada & valid.<br>
                        <small>${e.message}</small>
                    </p>
                `;
            }
        }

        async function requestWakeLock() {
            if ('wakeLock' in navigator) {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => {
                        console.log('Wake Lock telah dilepas');
                    });
                    console.log('Wake Lock aktif: Layar akan tetap menyala');
                } catch (err) {
                    console.error(`Gagal mengaktifkan Wake Lock: ${err.name}, ${err.message}`);
                }
            } else {
                console.warn('Wake Lock API tidak didukung di browser ini');
            }
        }

        async function releaseWakeLock() {
            if (wakeLock !== null) {
                try {
                    await wakeLock.release();
                    wakeLock = null;
                    console.log('Wake Lock dilepas');
                } catch (err) {
                    console.error(`Gagal melepaskan Wake Lock: ${err.name}, ${err.message}`);
                }
            }
        }

        playPauseBtn.addEventListener('click', () => {
            if (wavesurfer.isPlaying()) {
                wavesurfer.pause();
                releaseWakeLock(); // Lepas wake lock saat pause
            } else {
                wavesurfer.play().catch(()=>{});
                requestWakeLock(); // Aktifkan wake lock saat play
            }
        });

        startBtn.addEventListener('click', () => {
            tutorial.style.display = 'none';
            wavesurfer.play().catch(()=>{});
            requestWakeLock(); // Aktifkan wake lock saat tombol mulai ditekan
        });

        // Event untuk tombol tampilkan surat
        showLetterBtn.addEventListener('click', () => {
            imagePopup.style.display = 'flex';
        });

        // Event untuk tombol close popup
        closePopup.addEventListener('click', () => {
            imagePopup.style.display = 'none';
        });

        document.addEventListener('visibilitychange', () => {
            if (document.hidden && wavesurfer) {
                wavesurfer.pause();
                releaseWakeLock(); // Lepas wake lock saat tab/minimize
            } else if (!document.hidden && wavesurfer && wavesurfer.isPlaying()) {
                requestWakeLock(); // Re-aktifkan jika kembali dan masih playing
            }
        });

        init(audioSrc);
    </script>
</body>
</html>